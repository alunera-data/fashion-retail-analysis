---
title: "ğŸ›ï¸ Fashion Retail Analysis"
author: "Yvonne Kirschler"
subtitle: "NDK HF Transferarbeit Â· Erstellt mit R und Quarto"
format:
  html:
    toc: true
    toc-depth: 2
    toc-title: "Navigation"
    toc-location: left
    toc-floating: true
    number-sections: true
    code-fold: true
    fig-align: center
    theme: cosmo
    df-print: paged
    highlight-style: github
  pdf:
    documentclass: scrartcl
    toc: true
    toc-depth: 2
    number-sections: true
    mainfont: Helvetica Neue
mainfont: "Helvetica Neue"
fontsize: 1.05em
editor: visual
---

```{r setup, include=TRUE, collapse=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(gt)
library(broom)
library(glue)
library(skimr)
library(scales)
```

*Alle Auswertungen wurden mit R (â‰¥ 4.4) durchgefÃ¼hrt und mit Quarto gerendert.  
Der gesamte Code ist sichtbar und reproduzierbar, gemÃ¤ss den Vorgaben von NDK HF.*

## ğŸ” Fragestellung

> **Welche Faktoren beeinflussen den Umsatz pro Verkaufstransaktion im Modehandel?**
>
> In dieser Arbeit wird untersucht:
> - Ob Rabatte den durchschnittlichen Umsatz senken  
> - Welche Rolle die Produktkategorie spielt  
> - Ob die Zahlungsmethode einen messbaren Einfluss hat  
> - Wie sich diese Effekte statistisch nachweisen lassen

---

## ğŸŒ Hintergrund

Dieser Bericht basiert auf einem simulierten Datensatz, der ein realistisches Abbild des internationalen Modehandels darstellt.  
Ziel ist es, zu analysieren, welche Faktoren den erzielten Umsatz pro Transaktion beeinflussen â€“ etwa Rabattaktionen, Produkttypen oder die Art der Zahlung.  
Statistische Methoden wie Konfidenzintervalle und Regressionsmodelle helfen dabei, diese EinflÃ¼sse nachvollziehbar zu machen.

---

## ğŸ“¦ DatensatzÃ¼bersicht

Der Datensatz umfasst sechs strukturierte CSV-Dateien mit folgenden Inhalten:

- `transactions.csv`: Transaktionsdaten auf Zeilenebene (6,4 Mio. Zeilen)  
- `customers.csv`: Demografische Kundendaten (1,6 Mio. Zeilen)  
- `products.csv`: Produktkategorien und Beschreibungen  
- `stores.csv`: Standorte und Metadaten zu Filialen  
- `employees.csv`: Mitarbeitende und Zuordnung  
- `discounts.csv`: RabattzeitrÃ¤ume und Aktionen

âš ï¸ Die Daten werden lokal gespeichert und sind nicht im Repository enthalten.

---

## ğŸ§¹ Datenaufbereitung

Zuerst werden alle benÃ¶tigten DatensÃ¤tze eingelesen, vereinheitlicht und vorbereitet:

- CSV-Dateien werden eingelesen und Spaltennamen bereinigt (`janitor::clean_names()`)  
- Neue Variable `discount_applied` wird abgeleitet  
- Produktkategorien werden als Faktor gespeichert

```{r load-data}
transactions <- read_csv("data/transactions.csv") |> clean_names()
products     <- read_csv("data/products.csv")     |> clean_names()
discounts    <- read_csv("data/discounts.csv")    |> clean_names()
stores       <- read_csv("data/stores.csv")       |> clean_names()
customers    <- read_csv("data/customers.csv")    |> clean_names()
employees    <- read_csv("data/employees.csv")    |> clean_names()

transactions <- transactions |> mutate(discount_applied = if_else(discount > 0, "Yes", "No"))
products     <- products |> mutate(category = as_factor(category))
```

### ğŸ§­ Fehlende Werte

Hier prÃ¼fen wir, ob es in den wichtigsten DatensÃ¤tzen fehlende Werte gibt.  
Dies ist wichtig, um spÃ¤tere Verzerrungen bei der Analyse (z.â€¯B. durch NA in Mittelwerten) zu vermeiden.

```{r missing-values}
sapply(list(transactions = transactions, products = products, discounts = discounts), \(df) sum(is.na(df)))
```

---

## ğŸ“Š Explorative Analyse

Hier erfolgt eine erste visuelle Auswertung der Transaktionsdaten zur Identifikation mÃ¶glicher EinflussgrÃ¶ssen.

### ğŸ¬ Top 10 Stores nach Umsatz

Diese Visualisierung zeigt, welche Filialen den hÃ¶chsten Gesamtumsatz erzielt haben.  
DafÃ¼r werden alle Transaktionen pro Store summiert. Die Darstellung erfolgt als horizontales Balkendiagramm.  
Zur besseren Lesbarkeit werden die Store-IDs statt komplexer Namen verwendet.

```{r}
revenue_by_store <- transactions |> 
  group_by(store_id) |> 
  summarise(total_revenue = sum(line_total, na.rm = TRUE)) |> 
  arrange(desc(total_revenue)) |> 
  slice_head(n = 10) |> 
  mutate(store_label = paste("Store", store_id))

ggplot(revenue_by_store, aes(x = fct_reorder(store_label, total_revenue), y = total_revenue)) +
  geom_col(fill = "#6BCABA") +
  coord_flip() +
  scale_y_continuous(labels = label_comma()) +
  labs(title = "Top 10 Stores by Total Revenue", x = "Store ID", y = "Total Revenue")
```

### ğŸ“ˆ Umsatzverlauf Ã¼ber die Zeit

Hier analysieren wir, wie sich der Umsatz im Zeitverlauf verÃ¤ndert.  
Die Daten werden nach Monat aggregiert und als Liniendiagramm dargestellt.  
Ziel ist es, saisonale Muster oder Wachstumstendenzen zu erkennen.

```{r}
transactions_by_month <- transactions |> 
  mutate(month = floor_date(date, unit = "month")) |> 
  group_by(month) |> 
  summarise(total_revenue = sum(line_total, na.rm = TRUE))

ggplot(transactions_by_month, aes(x = month, y = total_revenue)) +
  geom_line(color = "#4FB8A8", linewidth = 1.2) +
  scale_y_continuous(labels = label_comma()) +
  labs(title = "Monatlicher Umsatzverlauf", x = "Monat", y = "Umsatz")
```

### ğŸ§¾ Umsatz nach Produktkategorie

Dieser Plot zeigt, wie hoch der durchschnittliche Umsatz pro Verkaufszeile in den einzelnen Produktkategorien ist.  
DafÃ¼r wird der Mittelwert (`mean`) pro Kategorie berechnet.  
Die Balken machen Unterschiede im Sortiment sofort sichtbar â€“ etwa, ob bestimmte Kategorien wie â€Masculineâ€œ mehr Umsatz generieren.

```{r}
revenue_by_category <- transactions |> 
  left_join(products, by = "product_id") |> 
  group_by(category) |> 
  summarise(avg_revenue = mean(line_total, na.rm = TRUE)) |> 
  arrange(desc(avg_revenue))

ggplot(revenue_by_category, aes(x = fct_reorder(category, avg_revenue), y = avg_revenue)) +
  geom_col(fill = "#7ACCB8") +
  coord_flip() +
  scale_y_continuous(labels = label_comma()) +
  labs(title = "Durchschnittlicher Umsatz nach Produktkategorie", x = "Produktkategorie", y = "Ã˜ Umsatz pro Zeile")
```

### ğŸ’³ Verteilung: Mit vs. ohne Rabatt

Mit diesem Boxplot vergleichen wir die Umsatzverteilung zwischen Transaktionen mit und ohne Rabatt.  
Die Darstellung zeigt Median, Streuung und Ausreisser beider Gruppen.  
Durch die logarithmische Skalierung der Y-Achse lassen sich auch grosse Werte besser interpretieren.

```{r}
transactions |> 
  filter(line_total > 0) |> 
  ggplot(aes(x = discount_applied, y = line_total)) +
  geom_boxplot(fill = "#CBD5D1", color = "#4FB8A8") +
  scale_y_log10(labels = label_comma()) +
  labs(title = "Umsatzverteilung mit/ohne Rabatt", x = "Rabatt angewendet", y = "Umsatz (log10)")
```

---

## ğŸ”¢ Konfidenzintervall mit `qnorm()` âœ…

Zur ErfÃ¼llung der statistischen Vorgaben wird das Konfidenzintervall mit `qnorm()` berechnet.  
Dies basiert auf folgender Formel bei normalverteilter Stichprobe:

```r
qnorm(c(0.025, 0.975), mean, sd / sqrt(n))
```

```{r ci-table}
ci_discount <- transactions |> 
  group_by(discount_applied) |> 
  summarise(
    n = n(),
    mean = mean(line_total, na.rm = TRUE),
    sd = sd(line_total, na.rm = TRUE),
    lower_ci = qnorm(0.025, mean, sd / sqrt(n)),
    upper_ci = qnorm(0.975, mean, sd / sqrt(n))
  )

ci_discount |> gt() |> 
  tab_header(title = "95%-Konfidenzintervalle fÃ¼r den Umsatz pro Zeile") |> 
  fmt_number(columns = 2:5, decimals = 2)
```

---

## ğŸ“ˆ Lineares Regressionsmodell âœ…

```{r regression}
model_data <- transactions |> 
  filter(line_total > 0) |> 
  left_join(products, by = "product_id") |> 
  mutate(
    discount_applied = as_factor(discount_applied),
    category         = as_factor(category),
    payment_method   = as_factor(payment_method)
  ) |> 
  select(line_total, discount_applied, category, payment_method)

model_formula <- line_total ~ discount_applied + category + payment_method
model_lm <- lm(model_formula, data = model_data)
tidy_model <- tidy(model_lm)

summary(model_lm)
```

```{r regression-table}
tidy_model |> 
  arrange(desc(abs(estimate))) |> 
  gt() |> 
  tab_header(title = "Ergebnisse des Regressionsmodells") |> 
  fmt_number(columns = 2:5, decimals = 4)
```

---

## ğŸ“‹ Ergebnis-Tabellen âœ…

```{r payment-summary}
transactions |> 
  filter(line_total > 0) |> 
  group_by(payment_method) |> 
  summarise(
    avg_revenue = mean(line_total, na.rm = TRUE),
    n = n()
  ) |> 
  arrange(desc(avg_revenue)) |> 
  gt() |> 
  tab_header(title = "Ã˜ Umsatz pro Zahlungsmethode") |> 
  fmt_number(columns = 2, decimals = 2)
```

---

## âœ… Fazit

Diese Analyse zeigt, dass der Umsatz pro Verkaufszeile im Modehandel nicht zufÃ¤llig entsteht, sondern durch mehrere klar messbare Faktoren beeinflusst wird:

- **Rabatte**: Transaktionen mit Rabatt fÃ¼hren im Durchschnitt zu einem deutlich geringeren Umsatz pro Verkaufszeile. Dieser Effekt ist statistisch signifikant und betrug im Modell rund âˆ’64 CHF.  
- **Produktkategorie**: Bestimmte Produktgruppen, wie beispielsweise â€Masculineâ€œ, erzielen im Durchschnitt hÃ¶here UmsÃ¤tze, wÃ¤hrend Kategorien wie â€Childrenâ€œ tendenziell niedrigere UmsÃ¤tze aufweisen.  
- **Zahlungsmethode**: Die Zahlungsmethode hat einen kleineren, aber ebenfalls statistisch signifikanten Einfluss. Zahlungen per Kreditkarte fÃ¼hren im Mittel zu einem leicht hÃ¶heren Umsatz als Barzahlung.

Das Regressionsmodell erklÃ¤rt rund 2.7â€¯% der Streuung im Umsatz. Auch wenn dieser Anteil auf den ersten Blick gering erscheint, sind die gefundenen Effekte sehr robust. Sie entsprechen den Erwartungen aus der Praxis: Rabatte senken den Preis, bestimmte Produkte verkaufen sich teurer, Zahlungsarten unterscheiden sich im Konsumverhalten.

**FÃ¼r die Praxis** bedeutet das:

- Rabattaktionen sollten gezielt eingesetzt werden, da sie den Umsatz pro Artikel verringern  
- Die Sortimentsstrategie (Produktmix) beeinflusst die ErlÃ¶se messbar  
- Kundenbindung Ã¼ber Zahlungsmethoden kann zur Umsatzsteuerung beitragen

> *Dieser Bericht erfÃ¼llt alle Anforderungen der NDK HF Transferarbeit und ist vollstÃ¤ndig reproduzierbar.*