---
title: "Fashion Retail Analysis"
author: "Yvonne Kirschler"
format: html
editor: visual
---

```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
library(gt)
library(broom)
library(glue)
library(skimr)
```

# Background

The global fashion industry is shaped by growing competition, changing consumer behavior, and increasing data availability.\
Retail store networks are an essential part of most fashion brands, yet their success depends on many factors – such as location, store type, founding year, brand strength, or discount strategies.

This project explores how these characteristics affect store performance using a simulated dataset of over 60,000 global transactions.

------------------------------------------------------------------------

# Research Questions

What factors drive store performance in global fashion retail?

In particular, this analysis investigates:

-   Differences in store performance by country, brand, and founding year
-   Performance variations across store types and categories
-   The impact of discounts on store-level revenue
-   Relationships identifiable through statistical models

The analysis is conducted in **R** using **Quarto**, **ggplot2**, **linear regression**, and **confidence intervals** via `qnorm()` for statistical interpretation.

## Dataset Overview

The project uses a synthetic, but highly realistic dataset simulating global fashion retail operations.\
It includes 6 interrelated CSV files:

-   **transactions.csv** (6.4 million rows): Line-level transactions with price, quantity, discount, product, customer, employee and store reference
-   **customers.csv** (1.6 million): Demographic customer data
-   **products.csv**: Product IDs, categories and multilingual descriptions
-   **stores.csv**: Locations, sizes and geospatial data of stores
-   **employees.csv**: Employee assignments and roles
-   **discounts.csv**: Structured promotional campaign information

All data is loaded locally and not shared in the repository.

## Data Preparation

All datasets were cleaned and harmonized using R. The following transformations were applied:

-   **Factor conversion** for IDs, categories and groupings (e.g. `store_id`, `gender`, `product_id`)
-   **Date conversion** for transaction dates, discount periods, and customer birthdates
-   **Column standardization** using `janitor::clean_names()` to ensure consistent naming
-   **Initial NA check** to assess missing value patterns

``` r
sapply(list(
  transactions = transactions,
  products = products,
  discounts = discounts
), \(df) sum(is.na(df)))
```

### Missing Value Summary

| Dataset        | Missing Values |
|----------------|----------------|
| `transactions` | 4,763,885      |
| `products`     | 14,515         |
| `discounts`    | 20             |

The decision on how to handle these values will be made contextually in the relevant analysis steps (e.g. filtering, imputation, or exclusion).

## Exploratory Data Analysis (EDA)

In this phase, we explored the main transactional and categorical structures of the dataset\
to identify patterns and revenue drivers.

### 1. Top 10 Stores by Total Revenue

To avoid encoding issues with multilingual store names,\
we used the store ID (`store_id`) as the primary label in visualizations.

``` r
revenue_by_store <- transactions |>
  group_by(store_id) |>
  summarise(total_revenue = sum(line_total, na.rm = TRUE)) |>
  arrange(desc(total_revenue)) |>
  slice_head(n = 10) |>
  mutate(store_label = paste("Store", store_id))

ggplot(revenue_by_store, aes(x = fct_reorder(store_label, total_revenue), y = total_revenue)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  scale_y_continuous(labels = scales::label_comma()) +
  labs(
    title = "Top 10 Stores by Total Revenue",
    x = "Store ID",
    y = "Total Revenue"
  )
```

### 2. Revenue Over Time

``` r
transactions_by_month <- transactions |>
  mutate(month = floor_date(date, unit = "month")) |>
  group_by(month) |>
  summarise(total_revenue = sum(line_total, na.rm = TRUE))

ggplot(transactions_by_month, aes(x = month, y = total_revenue)) +
  geom_line(color = "darkgreen", linewidth = 1) +
  scale_y_continuous(labels = label_comma()) +
  labs(
    title = "Monthly Revenue Over Time",
    x = "Month",
    y = "Revenue"
  )
```

### 3. Revenue by Product Category

``` r
revenue_by_category <- transactions |>
  left_join(products, by = "product_id") |>
  group_by(category) |>
  summarise(avg_revenue = mean(line_total, na.rm = TRUE)) |>
  arrange(desc(avg_revenue))

ggplot(revenue_by_category, aes(x = fct_reorder(category, avg_revenue), y = avg_revenue)) +
  geom_col(fill = "coral") +
  coord_flip() +
  scale_y_continuous(labels = label_comma()) +
  labs(
    title = "Average Line Revenue by Product Category",
    x = "Product Category",
    y = "Average Line Revenue"
  )
```

### 4. Revenue Distribution: Discount vs. No Discount

``` r
transactions <- transactions |>
  mutate(discount_applied = if_else(discount > 0, "Yes", "No"))

transactions |>
  filter(line_total > 0) |>  # filter out zero and negative values for log scale
  ggplot(aes(x = discount_applied, y = line_total)) +
  geom_boxplot(fill = "plum") +
  scale_y_log10(labels = label_comma()) +
  labs(
    title = "Revenue Distribution by Discount Applied",
    x = "Discount Applied",
    y = "Line Total (log10)"
  )
```

### 5. Summary Table: Discounted vs. Non-Discounted Transactions

``` r
summary_discount <- transactions |>
  group_by(discount_applied) |>
  summarise(
    n = n(),
    avg_revenue = mean(line_total, na.rm = TRUE),
    median_revenue = median(line_total, na.rm = TRUE)
  ) |>
  arrange(desc(avg_revenue))

gt(summary_discount)
```

✔️ These exploratory results provide a strong foundation for modeling revenue dynamics\
and evaluating pricing and discount strategies in the next steps.

## Confidence Interval Calculation

To estimate the reliability of average transaction revenues,\
95% confidence intervals were calculated using the normal distribution and the `qnorm()` function.

### Example (Theoretical)

As required by the assessment, a demonstration was performed using the following standard example:

``` r
qnorm(c(0.025, 0.975), mean = 2, sd = 1.2)
```

This results in the lower and upper boundaries of the 95% confidence interval\
for a normally distributed variable with a mean of 2 and a standard deviation of 1.2.

### Real-World Application

To apply this method to actual data, line revenues from transactions were grouped by whether a discount was applied.\
Then, the sample mean, standard deviation, and sample size were used to calculate confidence intervals\
via:

``` r
qnorm(c(0.025, 0.975), mean = mean_value, sd = sd_value / sqrt(n))
```

### Output Table

```{r}
gt(ci_discount) |>
  tab_header(title = "95% Confidence Intervals for Line Revenue")
```

This confirms that the average line revenue is lower in discounted transactions.\
While the absolute difference is relatively small, it is consistent across a large sample.\
A regression model will be used in the next step to assess whether the difference is statistically significant.

## Linear Regression Model

To investigate which factors influence line-level revenue, a linear regression model was estimated using the formula:

```r
line_total ~ discount_applied + category + payment_method
```

### Data Preparation

- Only transactions with a positive `line_total` were included  
- Product information was joined for category assignment  
- All relevant variables were converted to factors for modeling

### Model Output

```{r}
summary(model_lm)
```

Key estimates (formatted with `broom` and `gt`):

```{r}
gt(tidy_model) |>
  tab_header(title = "Regression Results: Line Revenue Model")
```

### Interpretation

- **Discounts** significantly reduce line-level revenue (`−64.45` units on average)  
- **Masculine** product categories are associated with a higher average revenue (`+21.43`)  
- **Children** categories result in lower revenue compared to the baseline (`−20.74`)  
- **Credit card payments** show a slight but significant increase (`+0.46`)  
- The model explains **2.7% of the variance** in the outcome variable (`R² = 0.0271`)

### Notes

While the model's explanatory power is limited, the direction and significance of the coefficients support expected business patterns. The model can be extended or refined in future steps, such as interaction terms or log-transformed dependent variables.
